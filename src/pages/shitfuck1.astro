---
import Layout from "../layouts/Layout.astro";
---

<Layout title="Ethan Wu | Potato">
    <main
        class="min-h-screen py-20 px-4 bg-neutral-950 overflow-hidden relative flex flex-col items-center justify-center"
    >
        <div
            class="absolute inset-0 bg-[linear-gradient(to_right,#4f4f4f2e_1px,transparent_1px),linear-gradient(to_bottom,#4f4f4f2e_1px,transparent_1px)] bg-[size:4rem_4rem] [mask-image:radial-gradient(ellipse_60%_50%_at_50%_0%,#000_70%,transparent_100%)] pointer-events-none"
        >
        </div>

        <!-- Back Button - Fixed to viewport to avoid overlap -->
        <a
            href="/"
            class="fixed top-8 left-8 text-neutral-500 hover:text-white transition-colors z-50 font-mono text-sm uppercase tracking-widest backdrop-blur-sm px-4 py-2 rounded-full border border-neutral-800 bg-neutral-900/50 hover:bg-neutral-800"
            >‚Üê Return to Safety</a
        >

        <div class="relative z-10 flex flex-col items-center w-full max-w-4xl">
            <h1
                class="text-4xl md:text-6xl font-black text-white mb-20 text-center tracking-tighter uppercase leading-none"
            >
                Potato Spinning at<br />
                <span
                    class="text-transparent bg-clip-text bg-gradient-to-r from-amber-300 via-yellow-500 to-amber-700 animate-pulse"
                    >Incredible Hihg Speed</span
                >
            </h1>

            <div
                class="relative w-72 h-72 md:w-[32rem] md:h-[32rem] flex items-center justify-center mb-24 perspective text-[0px]"
            >
                <div
                    class="absolute bottom-[-20%] w-[80%] h-[20%] bg-black/50 blur-3xl rounded-[100%]"
                >
                </div>

                <img
                    id="potato"
                    src="/potat.png"
                    alt="Spinning Potato"
                    class="w-full h-full object-contain drop-shadow-2xl rounded-full will-change-transform"
                />
            </div>

            <div
                class="font-mono bg-neutral-900/80 backdrop-blur-md border border-neutral-800 p-8 rounded-2xl w-full max-w-md shadow-2xl relative overflow-hidden group"
            >
                <div
                    class="absolute inset-0 bg-[linear-gradient(to_right,#ffffff05_1px,transparent_1px),linear-gradient(to_bottom,#ffffff05_1px,transparent_1px)] bg-[size:1rem_1rem] pointer-events-none"
                >
                </div>

                <div class="flex justify-between items-end mb-4 relative z-10">
                    <span
                        class="text-neutral-500 uppercase text-xs tracking-[0.2em]"
                        >Angular Velocity</span
                    >
                    <div class="flex items-baseline gap-1">
                        <span
                            id="rpm"
                            class="text-5xl font-black text-amber-500 tabular-nums tracking-tighter shadow-amber-500/20 drop-shadow-lg"
                            >0</span
                        >
                        <span class="text-neutral-600 text-xs font-bold"
                            >RPM</span
                        >
                    </div>
                </div>

                <div
                    class="w-full bg-neutral-950 h-2 rounded-full overflow-hidden mb-2 relative z-10 border border-neutral-800"
                >
                    <div
                        id="bar"
                        class="h-full bg-gradient-to-r from-amber-600 to-yellow-400 w-0 transition-all duration-75 shadow-[0_0_10px_rgba(251,191,36,0.5)]"
                    >
                    </div>
                </div>

                <div
                    id="status"
                    class="text-xs text-center uppercase tracking-[0.3em] font-bold text-amber-700 h-4 relative z-10"
                >
                    Initializing...
                </div>
            </div>
        </div>
    </main>
</Layout>

<script>
    const potato = document.getElementById("potato") as HTMLImageElement;
    const rpmDisplay = document.getElementById("rpm");
    const bar = document.getElementById("bar");
    const status = document.getElementById("status");
    const potatoSrc = "/potat.png";
    const r2d2Src = "/r2d2.png";

    const startTime = Date.now();
    let lastFrameTime = Date.now();
    const timeToInfinity = 60000 * 3;

    let rotation = 0;
    let rpm = 0;

    let isR2 = false;

    function triggerR2() {
        if (!potato) return;
        const duration = Math.random() * 4000 + 1000;
        potato.src = r2d2Src;
        isR2 = true;

        setTimeout(() => {
            potato.src = potatoSrc;
            isR2 = false;

            setTimeout(triggerR2, Math.random() * 5000 + 1000);
        }, duration);
    }

    setTimeout(triggerR2, 2000);

    function animate() {
        const now = Date.now();
        const elapsed = now - startTime;
        const dt = (now - lastFrameTime) / 1000;
        lastFrameTime = now;

        const progress = Math.min(elapsed / timeToInfinity, 0.999);

        const maxAngle = (Math.PI / 2) * 0.98;

        let p = Math.tan(Math.pow(progress, 2) * maxAngle);

        let rawRpm = 5 + p * 50000;

        const noise = Math.random() * (rawRpm * 0.01);

        let currentRpm = Math.floor(rawRpm + noise);

        if (currentRpm < rpm) currentRpm = rpm;

        rpm = currentRpm;

        const rotationSpeed = rpm * 6;

        rotation += rotationSpeed * dt;

        if (potato) {
            potato.style.transform = `rotate(${rotation}deg)`;

            let filter = "";
            let transform = `rotate(${rotation}deg)`;

            if (rpm > 5000) {
                filter += ` saturate(${1 + rpm / 10000})`;
            }
            if (rpm > 20000) {
                const hue = (Date.now() / 2) % 360;
                filter += ` hue-rotate(${hue}deg)`;
            }
            if (rpm > 100000) {
                if (Math.random() > 0.9) filter += " invert(1)";

                const shiftX = (Math.random() - 0.5) * 20;
                const shiftY = (Math.random() - 0.5) * 20;
                transform += ` translate(${shiftX}px, ${shiftY}px) skew(${Math.random() * 10}deg)`;
            }

            if (rpm > 500000) {
                const scaleX = Math.random() * 2;
                const scaleY = Math.random() * 2;
                transform += ` scale(${scaleX}, ${scaleY})`;
                filter += ` blur(${Math.random() * 10}px) contrast(5)`;
            }

            potato.style.filter = filter;
            potato.style.transform = transform;
        }

        if (rpmDisplay) {
            rpmDisplay.innerText = rpm.toLocaleString("en-US");
        }

        if (status) {
            if (isR2) {
                status.innerText = "CLANKER DETECTED";
                status.className =
                    "text-xs text-center uppercase tracking-[0.3em] font-bold text-blue-400 h-4 relative z-10";
            } else {
                status.className =
                    "text-xs text-center uppercase tracking-[0.3em] font-bold text-amber-700 h-4 relative z-10 transition-colors duration-200";
                if (rpm < 500) status.innerText = "Potato is dormant";
                else if (rpm < 2000) status.innerText = "Vibrating with malice";
                else if (rpm < 10000) status.innerText = "The skin is peeling";
                else if (rpm < 50000)
                    status.innerText = "Atonement is required";
                else if (rpm < 200000)
                    status.innerText = "Starch is a construct";
                else if (rpm < 500000) status.innerText = "I can taste colors";
                else if (rpm < 1000000) status.innerText = "Look behind you";
                else status.innerText = "THERE IS ONLY POTATO";
            }
        }

        if (bar) {
            const p = Math.min((Math.log10(rpm + 1) / 6) * 100, 100);
            bar.style.width = `${p}%`;
        }

        requestAnimationFrame(animate);
    }

    requestAnimationFrame(animate);
</script>

<style>
    .perspective {
        perspective: 1000px;
    }
</style>
